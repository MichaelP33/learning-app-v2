import fs from "fs";
import path from "path";
import { fileURLToPath } from "url";

// Resolve repo root relative to this script's location
const __filename = fileURLToPath(import.meta.url);
const __dirname = path.dirname(__filename);
const root = path.resolve(__dirname, "..");

const articlesDir = path.join(root, "src", "components", "articles");
const registryPath = path.join(articlesDir, "registry.ts");

if (!fs.existsSync(articlesDir)) {
  fs.mkdirSync(articlesDir, { recursive: true });
}

const files = fs
  .readdirSync(articlesDir)
  .filter((f) => f.endsWith(".tsx") && f !== "registry.ts");

const entries = files.map((file) => {
  const id = path.basename(file, ".tsx");
  return `  "${id}": () => import("./${id}")`;
});

const content = `// AUTO-GENERATED by scripts/generate-article-registry.mjs
// Do not edit directly; run npm run generate:articles-registry
export const articleRegistry: Record<string, () => Promise<{ default: React.FC }>> = {
${entries.join(",\n")}
};
`;

fs.writeFileSync(registryPath, content);
console.log(
  `Generated article registry with ${entries.length} entries at ${registryPath}`
);
